<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Online Store</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.2/axios.js"></script>
  <link rel="stylesheet" href="base.css">
</head>
<body>
  <div id="app">
    <div class="background"></div>
      <!-- <div v-for="item in info">
        <div @click="showProduct(item.product_id)">
          {{item.product_name}}
        </div>
      </div> -->

      <!-- Image Map Generated by http://www.image-map.net/ -->
      <div class="nav">
        <div class="icon">
          <img @click="home" src="./img/logo.png" alt="">
        </div>
        <div class="cart button" @click="model=1">Cart</div>
      </div>
    <div class="main">
      <div class="home" style="margin:auto;" v-if="model==0">
        <div class="car-list"style="margin:auto;">
          <div class="car-item" v-for="item in array">
            <div class="car-icon">
              <img :src="item.image">
            </div>
            <div class="car-detail">
              <h3>
              {{item.ModelYear}}-{{item.Brand}}-{{item.Model}}
            </h3>
              <p>
                Category: {{item.Category}}
              </p>
              <p>
                Mileage: {{item.Mileage}} kms
              </p>
              <p>
                Fuel Type: {{item.FuelType}}
              </p>
              <p>
                Seats: {{item.Seats}}
              </p>
              <p>
                Availability: {{item.Availability==1}}
              </p>
              <p>
                Price Per Day: $ {{item.PricePerDay}}
              </p>
              <p>
                Description: {{item.Description}}
              </p>

            </div>
            <div class="button add-to-cart " @click="addCart(item)" :class="{unavailable:item.Availability==0}">Add to Cart</div>
          </div>
        </div>
      </div>

      <div class="product-infomation" v-if="model==1">
        <!-- {{product}} -->
        <div class="cart">
          <div class="content">
            <div class="title">
              <h2>
                Car Reservation
              </h2>
            </div>
            <div class="cart-header">
              <div class="item-attribute"  v-for="name in cart_header">
                {{name}}
              </div>
            </div>
            <div class="cart-list" >
              <div class="cart-item" v-for="(item,index) in cart_list">
                <div class="product-name item-attribute" width="200px">
                  <!-- {{item.product_name}} -->
                  <img :src="item.image" alt="">
                </div>
                <div class="unit_price item-attribute">
                  {{item.ModelYear}}-{{item.Brand}}-{{item.Model}}
                </div>
                <div class="amount item-attribute">
                  <div class="day">
                    <div class="remove" @click="update(index,-1)"></div>
                    {{item.amount}}
                    <div class="add" @click="update(index,1)"></div>
                  </div>
                </div>
                <div class=" item-attribute">
                  $ {{item.total_price}}
                </div>
                <div class="item-attribute">
                  <div class="button" @click="update(index,-1*item.amount)">Delete</div>
                </div>
              </div>
            </div>
            <div class="tool-bar">
              <div class="clear button" @click="clear">Clear</div>
              <div class="back button" @click="home">Back</div>
              <div class="purchase button" @click="purchase">Purchase</div>
              <div class="total-price"><h2>Total: $ {{total_cost}}</h2></div>
            </div>
          </div>
        </div>
      </div>

      <div class="personal-information" v-if="model==2">
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>First Name: </div>
          <input type="text" v-model="user_info.firstName">
        </div>
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>Last Name: </div>
          <input type="text" v-model="user_info.lastName">
        </div>
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>Line Address 1: </div>
          <input type="text"v-model="user_info.address">
        </div>
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>Suburb: </div>
          <input type="text" v-model="user_info.suburb">
        </div>
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>State: </div>
          <input type="text" v-model="user_info.state">
        </div>
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>Country: </div>
          <input type="text" v-model="user_info.country">
        </div>
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>Mobile number: </div>
          <input type="text" v-model="user_info.mobile">
        </div>
        <div class="entry">
          <div class="label"><span style="color:red;">*</span>Email: </div>
          <input type="text" v-model="user_info.email">
        </div>
        <div class="entry">
          <div class="total-price">
            You are required to pay $ {{total_cost}}
          </div>
        </div>
        <div class="button submit" @click="submit()">Submit</div>
      </div>
      <div class="confirm-information" v-if="model==3">
        <div class="entry">
          <div class="label">First Name: </div>
          {{user_info.firstName}}
        </div>
        <div class="entry">
          <div class="label">Last Name: </div>
          {{user_info.lastName}}
        </div>
        <div class="entry">
          <div class="label">Line Address 1: </div>
          {{user_info.address}}
        </div>
        <div class="entry">
          <div class="label">Suburb: </div>
          {{user_info.suburb}}
        </div>
        <div class="entry">
          <div class="label">State: </div>
          {{user_info.state}}
        </div>
        <div class="entry">
          <div class="label">Country: </div>
          {{user_info.country}}
        </div>
        <div class="entry">
          <div class="label">Mobile number: </div>
          {{user_info.mobile}}
        </div>
        <div class="entry">
          <div class="label">Email: </div>
          {{user_info.email}}
        </div>
        <div class="total-price">
          You are required to pay $ {{total_cost}}
        </div>
        <div class="button"  @click="model=2">Go back</div>
        <div class="confirm button" @click="confirm()">Confirm</div>
      </div>
      <div class="success" style="padding-top:50px;" v-if="model==4">
        Thanks for your purchase!
        We have send the electronic recept to your email.
      </div>
    </div>
  </div>
  <script>

    new Vue({
      el: '#app',
      data () {
        return {
          array:[],
          model:0,
          submenu:0,
          info: '123',
          quantity: 0,
          total_cost:0,
          user_info:{
            firstName:"",
            lastName:"",
            address:"",
            suburb:"",
            state:"",
            country:"",
            mobile:"",
            email:""
          },
          cart_list:[{
            product_id:"",
            product_name:"",
            unit_price:"",
            unit_quantity:"",
            in_stock:"",
            amount:"",
            total_price:""
          }],
          product: {
            product_id:"",
            product_name:"",
            unit_price:"",
            unit_quantity:"",
            in_stock:""
          },
          cart_header:["Thumbnail","Vehicle","Rental Day","Price","Action"],
          structure: ["Grocey Store"]

        }
      },
      methods:{
        searchByID(productID){
          for(var i in this.info) {
            if(this.info[i].product_id == productID) {
              return this.info[i]
            }
          }
        },
        getCar() {
          var parser, xmlDoc,xmlhttp;
          if(window.XMLHttpRequest){
            //IE7+ Firefox Safari Opera Chrome
            xmlhttp= new XMLHttpRequest()
          }else{
            //IE6 IE5
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")
          }
          xmlhttp.open("GET","cars.xml",false)
          xmlhttp.send()
          xmlDoc=xmlhttp.responseXML
          console.log(1)
          // var text = "<bookstore><book>" +
          // "<title>Everyday Italian</title>" +
          // "<author>Giada De Laurentiis</author>" +
          // "<year>2005</year>" +
          // "</book><book>" +
          // "<title>Everyday </title>" +
          // "<author>Giada De Laurentiis</author>" +
          // "<year>2005</year>" +
          // "</book></bookstore>";
          // parser = new DOMParser();
          // xmlDoc = parser.parseFromString(text,"text/xml");

          var xml=xmlDoc.getElementsByTagName("Car");
          var arr = [];
          for(var i in xml){
          	if(typeof(xml[i])!='object')
              	continue
          	var subarr = {};
          	var item = xml[i].childNodes;
              for(var j in item){
              	if(typeof(item[j].innerHTML)!='undefined'){
              		// subarr.push(item[j].innerHTML);
                  subarr[item[j].tagName]=item[j].innerHTML
                  }
          	}
              var baseURL = "./img/"
              subarr['image']= baseURL + subarr['Model'] + '.jpg'
              subarr['PricePerDay'] = Number.parseFloat(subarr['PricePerDay']).toFixed(2)
              // console.log(subarr['PricePerDay'])

              // console.log(subarr)
              arr.push(subarr);
          }
          this.array = arr
          console.log(arr);
        },
        addCart(item){
          const self = this
          // var reg = /[^0-9]+/
          // var str = this.quantity.toString()
          // alert(typeof(this.quantity))
          // if(str.match(reg)){
          //   alert("Invaild quantity, please input correct amount!!")
          //   return
          // }
          // if(Number(this.quantity)>item.in_stock){
          //   alert("Invaild quantity, please input correct amount!!")
          //   return
          // }

          if(item.Availability==0){
            alert("Sorry, this car is unavailable now! Please choose other car.")
            return
          }

          for(var i in self.cart_list){
            if(self.cart_list[i].Model == item.Model){
              // self.cart_list[i].amount= self.cart_list[i].amount+1
              // self.cart_list[i].total_price = Number(self.cart_list[i].total_price) + Number(self.cart_list[i].unit_price)
              // self.cart_list[i].total_price = Number.parseFloat(self.cart_list[i].total_price).toFixed(2)
              // self.cart_list.splice(i,1,self.cart_list[i])

              // this.update(i,Number(this.quantity))
              alert("You have added this car alreadly! Please choose other car.")
              return
            }
          }
          item.amount = 1
          item.total_price = item.amount*item.PricePerDay
          console.log(item.total_price)
          item.total_price = Number.parseFloat(item.total_price).toFixed(2)
          this.cart_list.push(item)
          self.total_cost = Number(self.total_cost) + Number(item.amount*item.PricePerDay)
          console.log(self.total_cost)
          self.total_cost = Number.parseFloat(self.total_cost).toFixed(2)
          alert("Add to Cart successfully")
        },
        update(i,num){
          const self = this
          // if(self.cart_list[i].amount+num>self.cart_list[i].in_stock){
          //   alert("Invaild quantity, please input correct amount!!")
          //   return
          // }
          self.cart_list[i].amount +=num
          self.total_cost = Number(self.total_cost) + Number(self.cart_list[i].PricePerDay*num)
          self.total_cost = Number.parseFloat(self.total_cost).toFixed(2)
          if(self.cart_list[i].amount == 0) {
            self.cart_list.splice(i,1)
          }else{
            self.cart_list[i].total_price = Number(self.cart_list[i].total_price) + Number(self.cart_list[i].PricePerDay*num)
            self.cart_list[i].total_price = Number.parseFloat(self.cart_list[i].total_price).toFixed(2)
            self.cart_list.splice(i,1,self.cart_list[i])
          }
        },
        home(){
          this.model = 0
        },
        clear(){
          this.cart_list = []
          this.model = 0
          this.total_cost = 0
        },
        showProduct(productID) {
          // var item = this.searchByID(productID)
          // this.product = item
          this.model = 1
          // this.quantity = 1
        },
        purchase(){
          if(this.cart_list.length == 0) {
            alert("Sorry, your cart can not be empty!!")
            return
          }
          this.user_info = {
            firstName:"",
            lastName:"",
            address:"",
            suburb:"",
            state:"",
            mobile:"",
            email:""
          }
          // for(var i in this.cart_list){
          //   var reg = /[^0-9]+/
          //   var str = this.cart_list[i].day.toString()
          //   // alert(typeof(this.quantity))
          //   if(str.match(reg)){
          //     alert("Invaild quantity, please input correct amount!!")
          //     return
          //   }
          //   if(Number(this.quantity)>item.in_stock){
          //     alert("Invaild quantity, please input correct amount!!")
          //     return
          //   }
          // }
          this.model = 2
        },
        submit(){
          for(var i in this.user_info) {
            if(this.user_info[i] == "") {
              alert(i+" can not be empty!!")
              return
            }
          }
          var reg = /^[_A-Za-z0-9-]+(\.[_A-Za-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/
          var result = this.user_info.email.match(reg)
          if(result == null) {
            alert("your email is unavailable! please check it!")
            return
          }
          var reg = /[^0-9]+/
          var str = this.user_info.mobile.toString()
          // alert(typeof(this.quantity))
          if(str.match(reg)){
            alert("your mobile number is not available! please check it!")
            return
          }
          this.model = 3
        },
        confirm(){
          const self = this
          axios.post('sendMail.php',{
            // params:{
              user_info:this.user_info,cart_list:this.cart_list
            // }
          })
            .then(function (response){
              // alert(response.data)
            })
          this.cart_list = []
          this.model = 4
        }
      },
      mounted () {
        this.clear()
        // this.info = [{
        //   product_id:"1000",
        //   product_name:"Fish Fingers",
        //   unit_price:"2.55",
        //   unit_quantity:"500 gram",
        //   in_stock:"1500"
        // },{
        //   product_id:"1001",
        //   product_name:"Fish Fingers",
        //   unit_price:"5.00",
        //   unit_quantity:"1000 gram",
        //   in_stock:"750"
        // }]
        // this.user_info = {
        //   firstName:"Joy",
        //   lastName:"Tang",
        //   address:"30/830 Bourke St.",
        //   suburb:"Waterloo",
        //   state:"NSW",
        //   mobile:"0450072939",
        //   email:"351211168@qq.com"
        // }
        // this.cart_list = [{
        //   product_id:"1000",
        //   product_name:"Fish Fingers",
        //   unit_price:"2.55",
        //   unit_quantity:"500 gram",
        //   in_stock:"1500",
        //   amount:"1",
        //   total_price:"2.55"
        // },{
        //   product_id:"1001",
        //   product_name:"Fish Fingers",
        //   unit_price:"5.00",
        //   unit_quantity:"1000 gram",
        //   in_stock:"750",
        //   amount:"1",
        //   total_price:"5.00"
        // }]
        // this.getProduct()
        this.getCar()
      }
    })
  </script>
</body>
</html>
